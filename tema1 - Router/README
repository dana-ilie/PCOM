# ROUTER PACKET FORWARDING PROCESS

```
Tatulescu Andreea, 321CD
Homework1
Communication Protocols Course
```

### How to run 

* sudo ./check.sh

	
### router.c

#### IMPLEMENTATION

* In order to parse the rtable, I have used route_table_entry struct, just like
the one used during laboratory. 
* I read the file line by line and convert the strings to their binary form 
using inet_pton() function and checking for errors.
* Sorting the rtable in order to obtain a good complexity for searching elements

The all process happens in a while loop.

### THE WHILE FLOW

* Extracting the ethernet header from the package...

* Checkimg through ether_type field if it is an ARP or an IP package...

* ARP PACKAGE
  - extracting the arp header...
    - ARP REQUEST
      - Checking if it is for the router because if it is NOT, the package can
      be dropped...
      - If the package is for the router, sending back ARP reply using 
      send_arp() function...
      - I have also used build_ethhdr() in order to build the reply package
    - ARP REPLY
      - Updating the arp_table, adding the new entry...
      - Extracting the package from the queue in order to send it forward...
      
* IP PACKAGE
 - extracting both ip and icmp headers...
   - Checking if it is for the router and if it is an icmp echo request...
     - if it is, sending icmp_reply using send_icmp() function...
     - if NOT for the router...
     	 - Checking cheksum, if wrong => drop the package
     	 - Checking ttl => sending error TIME_EXCEEDED using send_icmp_error...
     	 - No destination => sending error HOST_UNREACHABLE using send_icmp_error...
     	 - Recalculating checksum, updating ttl
     	 
     	 - Now, we need to know where to send the package, so looking for 
     	 next_hop in arp_table. If there is no entry for it, creating an broadcasted
     	 ARP request in order to find out its mac address.
     	 - If there is entry, normally sending the package...
     	 
## DIFFICULTIES
   - I had some difficulties because I have not correctly allocated some fields.




